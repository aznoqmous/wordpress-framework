import{r as x}from"./vendor.js";class n extends EventTarget{constructor(e,t={}){super(),!e[this.constructor.name]&&(this.container=e,this.container[this.constructor.name]=this,this.opts=t,this.build(),this.bind(),this.start())}build(){}bind(){}start(){}select(e,t=null){return t=t||this.container,t.querySelector(e)}selectAll(e,t=null){return t=t||this.container,Array.from(t.querySelectorAll(e))}create(e="div",t={},o=null){const r=document.createElement(e);for(const i in t)r[i]=t[i];return o&&o.append(r),r}async post(e,t={}){const o=new FormData;for(let r in t)o.append(r,t[r]);return await fetch(`/wp-json${e}`,{method:"POST","Content-Type":"application/json",body:o}).then(r=>r.json())}async sleep(e=0){return new Promise(t=>setTimeout(t,e))}static bind(e,t={},o=!1){return o&&new MutationObserver(i=>{Array.from(document.querySelectorAll(e)).map(a=>new this(a,t))}).observe(document.body,{childList:!0,subtree:!0}),Array.from(document.querySelectorAll(e)).map(r=>new this(r,t))}}class y extends n{bind(){this.update(),this.items.map(t=>this.bindItem(t)),new MutationObserver(t=>{for(const o of t)o.addedNodes.forEach(r=>this.bindItem(r))}).observe(this.container,{childList:!0})}update(){this.items=Array.from(this.container.children)}bindItem(e){if(e.classList.contains("clone")||e._dragbound)return;e._dragbound=!0,this.startY=0,this.offsetY=0,this.update(),e.addEventListener("mousedown",o=>{if(e.parentElement!==this.container)return;this.startY=o.pageY,this.offsetY=this.container.getBoundingClientRect().top-e.getBoundingClientRect().top;const r=this.startY-o.pageY+this.offsetY;this.container.addEventListener("mousemove",t),this.dragClone=e.cloneNode(!0),this.container.append(this.dragClone),this.dragClone.classList.add("clone"),this.dragClone.style.top=`${-r}px`,setTimeout(()=>e.classList.add("dragged"),100)});const t=o=>{const r=this.startY-o.pageY+this.offsetY;this.dragClone.style.top=`${-r}px`;const i=e.getBoundingClientRect();o.clientY<i.top&&(this.container.insertBefore(e,e.previousSibling),this.update(),this.dispatchEvent(new CustomEvent("dragchange"))),o.clientY>i.bottom&&(this.container.insertBefore(e.nextSibling,e),this.update(),this.dispatchEvent(new CustomEvent("dragchange")))};window.addEventListener("mouseup",o=>{this.startY=null,this.dragClone&&(this.dragClone.remove(),this.container.removeEventListener("mousemove",t),e.classList.remove("dragged"),setTimeout(()=>e.classList.remove("dragged"),100))})}}class d extends n{build(){this.selected=this.select(".selected"),this.searchInput=this.select(".search"),this.options=this.select(".options"),this.hiddenInput=this.select(".hidden-field"),this.id=this.hiddenInput.name.replace(/[\[\]]/g,"_").replace(/__/g,"_")}get isMultiple(){return this.select(".container").classList.contains("multiple")}get isSortable(){return this.select(".container").classList.contains("sortable")}get selectedItems(){return Array.from(this.selected.children)}get selectedIds(){return this.selectedItems.map(e=>e.dataset.id)}bind(){Array.from(this.selected.children).map(e=>this.bindItem(e)),Array.from(this.options.children).map(e=>this.bindItem(e)),this.searchInput.addEventListener("input",()=>{this._search(this.searchInput.value)}),window.addEventListener("click",e=>{this.container.classList.toggle("focused",this.container.contains(e.target))}),this.isSortable&&new y(this.selected).addEventListener("dragchange",()=>this.updateField())}static async search(e,t,o=null,r={}){if(this.abortController)try{this.abortController.abort("")}catch{}return this.abortController=new AbortController,await fetch("/wp-json/api/relation/search",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({query:t,model:e,exclude:o,...r}),signal:this.abortController.signal}).then(i=>i.json())}async _search(e){const t=this.selectedIds;this.searchInput.dataset.excludeId&&t.push(this.searchInput.dataset.excludeId),this.container.classList.add("loading"),this.clear();const o=await d.search(this.searchInput.dataset.model,e,t,this.container.dataset);this.container.classList.remove("loading"),this.clear(),o&&o.map(r=>this.addOptionItem(r))}clear(){this.options.innerHTML=""}addOptionItem(e){if(this.selectedIds.includes(e.id))return;const t=document.createElement("li");t.innerHTML=e._html||e.title||e.name,t.dataset.id=e.source_language_id||e.id,this.bindItem(t),this.options.append(t)}bindItem(e){e.style.viewTransitionName=`${this.id}${e.dataset.id}`,e.addEventListener("click",()=>{document.startViewTransition?document.startViewTransition(()=>{e.parentElement===this.options?this.addSelected(e):this.removeSelected(e),this.updateField()}):(e.parentElement===this.options?this.addSelected(e):this.removeSelected(e),this.updateField())})}addSelected(e){this.isMultiple||this.selectedItems.map(t=>this.removeSelected(t)),this.selected.append(e)}removeSelected(e){this.options.append(e)}updateField(){this.isMultiple?this.hiddenInput.value=this.selectedIds.length?JSON.stringify(this.selectedIds):null:this.hiddenInput.value=this.selectedIds.length?this.selectedIds[0]:null,this.hiddenInput.dispatchEvent(new CustomEvent("input"))}}class b extends n{build(){this.button=this.select('input[type="button"]'),this.hiddenInput=this.select('input[type="hidden"]'),this.previewContainer=this.select(".preview-container")}updatePreview(e){this.previewContainer.innerHTML="",e.filter(t=>t&&t.url).map(t=>{const o=this.create("figure",{},this.previewContainer);t.type=="image"&&this.create("img",{src:t.url},o),this.create("span",{innerHTML:t.filename},o)})}bind(){this.button.addEventListener("click",e=>{let t;if(e.preventDefault(),t){t.uploader.param("post_id",this.hiddenInput.value),t.open();return}wp.media.model.settings.post.id=this.hiddenInput.value,t=wp.media.frames.file_frame=wp.media({title:this.isMultiple?"Choisir des fichiers":"Choisir un fichier",button:{text:this.isMultiple?"Choisir des fichiers":"Choisir un fichier"},library:{type:this.container.dataset.filetype},multiple:this.isMultiple}),t.on("open",()=>{const o=t.state().get("selection");this.hiddenInput.value.split(",").forEach(function(i){const a=wp.media.attachment(i);a.fetch(),o.add(a?[a]:[])})}),t.on("select",()=>{const o=Array.from(t.state().get("selection")).map(r=>r.attributes);this.hiddenInput.value=o.map(r=>r.id).filter(r=>r).join(","),this.updatePreview(o)}),t.open()})}get isMultiple(){return!!this.container.dataset.multiple}}class g extends n{build(){this.icons=this.selectAll(".icon"),this.input=this.select("input"),this.removeButton=this.select(".button-danger")}bind(){this.icons.map(e=>{e.addEventListener("click",()=>{this.icons.map(t=>t.classList.toggle("active",t===e)),this.input.value=e.dataset.icon,this.removeButton.classList.remove("hidden")})}),this.removeButton.addEventListener("click",()=>{this.input.value=null,this.icons.map(e=>e.classList.remove("active")),this.removeButton.classList.add("hidden")})}}class h extends n{build(){this.selectAll(".color").map(e=>{const t=e.querySelector("input"),o=this.getLightness(t.value);e.classList.toggle("light",o>.5)}),this.hiddenInput=this.select("input.hidden")}bind(){this.selectAll(".color input").map(e=>{e.addEventListener("click",t=>{t.preventDefault(),setTimeout(()=>{e.checked=!e.checked,e.checked||(this.hiddenInput.checked=!0)})})})}getColorRgb(e){const t=document.createElement("canvas");t.width=1,t.height=1;const o=t.getContext("2d");return o.fillStyle=e,o.fillRect(0,0,1,1),o.getImageData(0,0,1,1).data}getLightness(e){const t=this.getColorRgb(e);return(t[0]+t[1]+t[2])/3/255}}class s extends n{build(){this.fieldsContainer=this.select(".entities"),this.addButton=this.fieldsContainer.parentElement.querySelector(":scope > .list-add"),this.template=this.select("template"),this.selector=this.container.dataset.name.replace(/\[/g,"\\[").replace(/\]/g,"\\]"),this.hiddenInput=document.createElement("input"),this.hiddenInput.name=this.container.dataset.name,this.hiddenInput.type="hidden",this.update()}get entities(){return Array.from(this.fieldsContainer.children)}bind(){this.addButton.addEventListener("click",()=>{this.fieldsContainer.append(...document.createRange().createContextualFragment(this.template.innerHTML).children),this.update()})}bindEntity(e){e.querySelector(":scope > .list-remove").addEventListener("click",t=>{e.remove(),this.update()})}update(){this.entities.map((e,t)=>{e.querySelectorAll("[for]").forEach(o=>{o.setAttribute("for",this.replaceId(o.getAttribute("for"),t))}),e.querySelectorAll("[name]").forEach(o=>{o.name=this.replaceName(o.name,t),o.id=this.replaceId(o.id,t)}),e.dataset.index=t,e.style.viewTransitionName=this.container.dataset.name+"-"+t}),d.bind(".relation-field"),b.bind(".upload-field"),g.bind(".icon-field"),h.bind(".color-field"),s.bind(".list-field"),this.entities.map(e=>this.bindEntity(e)),this.entities.length?this.hiddenInput.remove():this.container.append(this.hiddenInput)}replaceId(e,t){return e.replace(new RegExp(`${this.selector}\\[(\\d|INDEX)\\]`,"g"),`${this.container.dataset.name}[${t}]`)}replaceName(e,t){return e.replace(new RegExp(`${this.selector}\\[(\\d|INDEX)\\]`,"g"),`${this.container.dataset.name}[${t}]`)}}class w extends n{build(){this.field=this.select("input")}bind(){}}wp.blockEditor||(wp.blockEditor={InspectorControls:"",InnerBlocks:"",RichText:"",useBlockProps:"",MediaUpload:"",MediaUploadCheck:"",BlockControls:""});wp.compose||(wp.compose={createHigherOrderComponent:()=>()=>{}});wp.components||(wp.components={PanelBody:"",SelectControl:"",TextControl:"",InputControl:"",TextareaControl:"",CheckboxControl:"",MediaUpload:"",Heading:"",Popover:"",ToolbarButton:""});wp.element||(wp.element={Fragment:"",cloneElement:""});wp.serverSizeRender||(wp.serverSizeRender=()=>{});const{InspectorControls:c,InnerBlocks:S,RichText:R,MediaUpload:j,MediaUploadCheck:A,useBlockProps:v,BlockControls:B}=wp.blockEditor;wp.compose;const{PanelBody:p,SelectControl:F,TextControl:u,TextareaControl:T,Heading:M,InputControl:N,Button:O,Popover:Y,ToolbarButton:D,CheckboxControl:q}=wp.components;wp.element;wp.serverSizeRender;const f=l=>wp.i18n.__(l,"ifc");class k extends x.exports.Component{constructor(e){super(e),this.state={html:""}}componentDidMount(){this.update()}componentDidUpdate(e,t,o){this.props.attributes!==e.attributes&&this.update()}async update(){const e=new FormData;e.append("name",this.props.block),e.append("attributes",JSON.stringify(this.props.attributes));const t=await fetch("/wp-json/api/block/render",{method:"POST",body:e}).then(o=>o.json());this.setState({html:t})}render(){return React.createElement(React.Fragment,null,this.state.html?React.createElement("div",{dangerouslySetInnerHTML:{__html:this.state.html}}):"Chargement...")}}class _{constructor(e){this.loaded=!1,this.blockName=e}static register(e){const t=new this(e),o=JSON.parse(JSON.stringify(t));!wp.blocks||wp.blocks.registerBlockType(e,{...o,edit:r=>t.edit(r),save:r=>t.save(r)})}ready(e){}editor(e){return React.createElement(React.Fragment,null)}render(e){return React.createElement(React.Fragment,null)}edit(e){return this.loaded||(this.ready(e),this.loaded=!0),React.createElement(React.Fragment,null,this.render(e),this.editor(e))}save(e){return this.render(e)}}class m extends _{static register(e){const t=new this(e),o=JSON.parse(JSON.stringify(t));!wp.blocks||wp.blocks.registerBlockType(e,{...o,edit:r=>t.edit(r),save:()=>null})}render(e){const t=v(),{attributes:o}=e;return React.createElement("div",{...t},React.createElement(k,{block:this.blockName,attributes:o}))}}class E extends m{constructor(e){super(e),this.title="Actualit\xE9s mises en avant",this.icon="welcome-learn-more",this.category="layout",this.attributes={newsCount:{type:"integer",default:3}}}editor(e){const{attributes:t,setAttributes:o}=e,{newsCount:r}=e.attributes;return React.createElement(React.Fragment,null,React.createElement(c,null,React.createElement(p,{title:f("Contenu"),initialOpen:!0},React.createElement(u,{value:r,type:"number",label:f("Nombre d'\xE9l\xE9ments \xE0 afficher"),onChange:i=>o({newsCount:parseInt(i)})}))))}}E.register("wordpress-framework/news-featured-list");class C extends m{constructor(e){super(e),this.title="Liste d'actualit\xE9s filtr\xE9es",this.icon="welcome-learn-more",this.category="layout",this.attributes={newsCount:{type:"integer",default:3}}}editor(e){const{attributes:t,setAttributes:o}=e,{newsCount:r}=e.attributes;return React.createElement(React.Fragment,null,React.createElement(c,null,React.createElement(p,{title:f("Contenu"),initialOpen:!0},React.createElement(u,{value:r,type:"number",label:f("Nombre d'\xE9l\xE9ments \xE0 afficher"),onChange:i=>o({newsCount:parseInt(i)})}))))}}C.register("wordpress-framework/news-filtered-list");class z extends m{constructor(e){super(e),this.title="Derni\xE8res actualit\xE9s",this.icon="welcome-learn-more",this.category="layout",this.attributes={newsCount:{type:"integer",default:3}}}editor(e){const{attributes:t,setAttributes:o}=e,{newsCount:r}=e.attributes;return React.createElement(React.Fragment,null,React.createElement(c,null,React.createElement(p,{title:f("Contenu"),initialOpen:!0},React.createElement(u,{value:r,type:"number",label:f("Nombre d'\xE9l\xE9ments \xE0 afficher"),onChange:i=>o({newsCount:parseInt(i)})}))))}}z.register("wordpress-framework/news-latest-list");const I=async(l=0)=>new Promise(e=>setTimeout(e,l));document.addEventListener("DOMContentLoaded",async()=>{await I(100);const l=document.querySelector('form[name="post"],form.metabox-location-normal');if(!l)return;const e=Array.from(document.querySelectorAll(".editor-post-publish-button")),t=()=>Array.from(document.querySelectorAll(".editor-post-publish-button")).map(o=>{o.classList.toggle("disabled",!l.checkValidity())});l.append(document.createRange().createContextualFragment("<input type='submit' style='opacity: 0; pointer-events: none;'>")),t(),l.querySelectorAll("input,select,textarea").forEach(o=>{o.addEventListener("input",()=>t())}),l.addEventListener("keyup",()=>{t()}),e.map(o=>o.addEventListener("click",r=>{o.classList.contains("disabled")&&(r.stopImmediatePropagation(),r.preventDefault(),l.reportValidity())}))});d.bind(".relation-field");b.bind(".upload-field");g.bind(".icon-field");h.bind(".color-field");s.bind(".list-field");w.bind(".location-field");console.log("Wordpress Framework");
